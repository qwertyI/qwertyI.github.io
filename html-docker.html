<!DOCTYPE html>
<html lang="zh">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Ubuntu 安装 Docker（转） | Ning's Blog
</title>
  <link rel="canonical" href="https://qwertyI.github.io/html-docker.html">



  <link rel="stylesheet" href="https://qwertyI.github.io/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://qwertyI.github.io/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://qwertyI.github.io/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://qwertyI.github.io/theme/css/style.css">


<meta name="description" content="how to install docker.">
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1 class="title"><a href="https://qwertyI.github.io">Ning's Blog</a></h1>
          <ul class="list-inline">
            <li class="list-inline-item"><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
            <li class="list-inline-item"><a href="http://python.org/" target="_blank">Python.org</a></li>
            <li class="list-inline-item"><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
            <li class="list-inline-item"><a href="https://www.cnblogs.com/" target="_blank">cnblog</a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>Ubuntu 安装 Docker（转）
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2017-03-10T10:20:00">
        <i class="fa fa-clock-o"></i>
        五 10 三月 2017
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://qwertyI.github.io/category/dokcer.html">Dokcer</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://qwertyI.github.io/">N</a>,         <a href="https://qwertyI.github.io/">i</a>,         <a href="https://qwertyI.github.io/">n</a>,         <a href="https://qwertyI.github.io/">g</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://qwertyI.github.io/tag/docker.html">#Docker</a>      </li>
    </ul>
  </header>
  <div class="content">
    <p>===</p>
<p>Docker 支持以下的 Ubuntu 版本</p>
<ul>
<li>Ubuntu Trusty 14.04 (LTS) (64-bit)</li>
<li>Ubuntu Precise 12.04 (LTS) (64-bit)</li>
<li>Ubuntu Raring 13.04 and Saucy 13.10 (64 bit)</li>
</ul>
<p>这个页面可以指导你安装 Docker 包管理器，并了解其中的安装机制。通过下边的安装方式可以确保你获取的是最新版本的 Docker。如果你想要使用 'Ubuntu包管理器' 安装，你可以查阅你的 Ubuntu 文档。</p>
<h3>前提条件</h3>
<p>Docker 需要在64位版本的Ubuntu上安装。此外，你还需要保证你的 Ubuntu 内核的最小版本不低于 3.10，其中3.10 小版本和更新维护版也是可以使用的。</p>
<p>在低于3.10版本的内核上运行 Docker 会丢失一部分功能。在这些旧的版本上运行 Docker 会出现一些BUG，这些BUG在一定的条件里会导致数据的丢失，或者报一些严重的错误。</p>
<p>打开控制台使用 <code>uname -r</code>命令来查看你当前的内核版本。</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">uname</span> <span class="o">-</span><span class="n">r</span> 
<span class="mf">3.11.0</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="n">generic</span>
</pre></div>


<blockquote>
<p>Docker 要求 Ubuntu 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的Ubuntu版本是否支持 Docker 。</p>
</blockquote>
<h3>Trusty 14.04</h3>
<p>这个版本不需要考虑前提条件</p>
<h3>Precise 12.04 (LTS)</h3>
<p>对于Ubuntu Precise版本, 安装Docker需要内核在3.13及以上版本。如果你的内核版本低于3.13你需要升级你的内核。 通过下边的表，请查阅下边的表来确认你的环境需要哪些包。</p>
<p><table class="tg"> 
 <tr> 
    <td class="tg-031">linux-image-generic-lts-trusty</td> 
    <td class="tg-031e">基本Linux 内核镜像。这个内核内置了AUFS。这是运行Docker必备的软件。</td> 
 </tr> 
 <tr> 
    <td class="tg-031">linux-headers-generic-lts-trusty</td>
    <td class="tg-031e">允许ZFS和VirtualBox客户机额外的包。如果你不安装已存在内核的头文件，那么你可以跳过"trusty"内核的这些头文件。如果你不确定，为安全起见，你应该包含这些包。</td> 
 </tr> 
 <tr> 
    <td class="tg-031">xserver-xorg-lts-trusty</td> 
    <td class="tg-031e" rowspan="2">在没有Unity/Xorg的非图形环境中可选。<i>必选</i> 当在图形环境的机器中运行Doker时。
    <p>学习使用这些包的原因，请参考内核安装教程。详情 <a
href="https://wiki.ubuntu.com/Kernel/LTSEnablementStack" target="_blank">LTS
实现栈 Stack</a> &mdash; 参考每个版本下的标记5。</p></td> 
</tr>
 <tr> 
    <td class="tg-031">libgl1-mesa-glx-lts-trusty</td> 
    <td class="tg-031e" rowspan="2"></td>
</tr> 
</table> &nbsp;</p>
<p>通过下边的操作来升级你的内核和安装额外的包</p>
<ol>
<li>
<p>在Ubuntu系统中打开命令行控制台。</p>
</li>
<li>
<p>升级你的包管理器</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
</pre></div>


</li>
<li>
<p>安装所有必须和可选的包</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="n">generic</span><span class="o">-</span><span class="n">lts</span><span class="o">-</span><span class="n">trusty</span>
</pre></div>


<p>根据个人的系统环境来选择是否安装更多的包（前表列出）。</p>
</li>
<li>
<p>重启系统</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">reboot</span>
</pre></div>


</li>
<li>
<p>等到系统重启成功之后，查看<a href="#Ubuntu安装Docker">安装Docker</a></p>
</li>
</ol>
<h3>Saucy 13.10 (64 bit)</h3>
<p>Docker 使用 AUFS 作为默认的后端存储方式，如果你之前没有安装 AUFS ，Docker 在安装过程中会自动添加。</p>
<h2>Ubuntu安装Docker</h2>
<p>首先要确认你的 Ubuntu 版本是否符合安装 Docker 的前提条件。如果没有问题，你可以通过下边的方式来安装 Docker ：</p>
<ol>
<li>
<p>使用具有<code>sudo</code>权限的用户来登录你的Ubuntu。</p>
</li>
<li>
<p>查看你是否安装了<code>wget</code></p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">which</span> <span class="n">wget</span>
</pre></div>


<p>如果<code>wget</code>没有安装，先升级包管理器，然后再安装它。</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">wget</span>
</pre></div>


</li>
<li>
<p>获取最新版本的 Docker 安装包</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">wget</span> <span class="o">-</span><span class="n">qO</span><span class="o">-</span> <span class="n">https</span><span class="o">:</span><span class="c1">//get.docker.com/ | sh</span>
</pre></div>


<p>系统会提示你输入<code>sudo</code>密码，输入完成之后，就会下载脚本并且安装Docker及依赖包。</p>
</li>
<li>
<p>验证 Docker 是否被正确的安装</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">docker</span> <span class="n">run</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>


<p>上边的命令会下载一个测试镜像，并在容器内运行这个镜像。</p>
</li>
</ol>
<h2>Ubuntu Docker可选配置</h2>
<p>这部分主要介绍了 Docker 的可选配置项，使用这些配置能够让 Docker 在 Ubuntu 上更好的工作。</p>
<ul>
<li>创建 Docker 用户组</li>
<li>调整内存和交换空间(swap accounting) </li>
<li>启用防火墙的端口转发(UFW)</li>
<li>为 Docker 配置DNS服务</li>
</ul>
<h3>创建 Docker 用户组</h3>
<p>docker 进程通过监听一个 Unix Socket 来替代 TCP 端口。在默认情况下，docker 的 Unix Socket属于<code>root</code>用户，当然其他用户可以使用<code>sudo</code>方式来访问。因为这个原因， docker 进程就一直是<code>root</code>用户运行的。</p>
<p>为了在使用 <code>docker</code> 命令的时候前边不再加<code>sudo</code>，我们需要创建一个叫 <code>docker</code> 的用户组，并且为用户组添加用户。然后在 <code>docker</code> 进程启动的时候，我们的 <code>docker</code> 群组有了 Unix Socket 的所有权，可以对 Socket 文件进行读写。</p>
<blockquote>
<p>注意：<code>docker</code> 群组就相当于root用户。有关系统安全影响的细节，请查看 <a href="">Docker 进程表面攻击细节</a></p>
</blockquote>
<p>创建 <code>docker</code> 用户组并添加用户</p>
<ol>
<li>
<p>使用具有<code>sudo</code>权限的用户来登录你的Ubuntu。</p>
<p>在这过程中，我们假设你已经登录了Ubuntu。</p>
</li>
<li>
<p>创建 <code>docker</code> 用户组并添加用户。</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">usermod</span> <span class="o">-</span><span class="n">aG</span> <span class="n">docker</span> <span class="n">ubuntu</span>
</pre></div>


</li>
<li>
<p>注销登录并重新登录</p>
<p>这里要确保你运行用户的权限。</p>
</li>
<li>
<p>验证 <code>docker</code> 用户不使用 <code>sudo</code> 命令开执行 <code>Docker</code></p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">run</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>


</li>
</ol>
<h3>调整内存和交换空间(swap accounting)</h3>
<p>当我们使用 Docker 运行一个镜像的时候，我们可能会看到如下的信息提示：</p>
<div class="highlight"><pre><span class="n">WARNING</span><span class="o">:</span> <span class="n">Your</span> <span class="n">kernel</span> <span class="n">does</span> <span class="n">not</span> <span class="n">support</span> <span class="n">cgroup</span> <span class="n">swap</span> <span class="n">limit</span><span class="o">.</span> <span class="n">WARNING</span><span class="o">:</span> <span class="n">Your</span>
<span class="n">kernel</span> <span class="n">does</span> <span class="n">not</span> <span class="n">support</span> <span class="n">swap</span> <span class="n">limit</span> <span class="n">capabilities</span><span class="o">.</span> <span class="n">Limitation</span> <span class="n">discarded</span><span class="o">.</span><span class="err">、</span>
</pre></div>


<p>为了防止以上错误信息提示的出现，我们需要在系统中启用内存和交换空间。我们需要修改系统的 GUN GRUB (GNU GRand Unified Bootloader) 来启用内存和交换空间。开启方法如下：</p>
<ol>
<li>
<p>使用具有<code>sudo</code>权限的用户来登录你的Ubuntu。</p>
</li>
<li>
<p>编辑 <code>/etc/default/grub</code> 文件</p>
</li>
<li>
<p>设置 <code>GRUB_CMDLINE_LINUX</code> 的值如下：</p>
<div class="highlight"><pre><span class="n">GRUB_CMDLINE_LINUX</span><span class="o">=</span><span class="s">&quot;cgroup_enable=memory swapaccount=1&quot;</span>
</pre></div>


</li>
<li>
<p>保存和关闭文件 </p>
</li>
<li>
<p>更新 GRUB</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">grub</span>
</pre></div>


</li>
<li>
<p>重启你的系统。</p>
</li>
</ol>
<h3>允许UFW端口转发</h3>
<p>当你在运行 <code>docker</code> 的宿主主机上使用UFW（简单的防火墙）。你需要做一些额外的配置。Docker 使用桥接的方式来管理网络。默认情况下，UFW 过滤所有的端口转发策略。因此，当在UFW启用的情况下使用 <code>docker</code> ,你必须适当的设置UFW的端口转发策略。</p>
<p>默认情况下UFW是过滤掉所有的入站规则。如果其他的主机能够访问你的容器。你需要允许Docker的默认端口(2375)的所有连接。</p>
<p>设置 UFW 允许Docker 端口的入站规则：</p>
<ol>
<li>使用具有<code>sudo</code>权限的用户来登录你的Ubuntu。</li>
<li>
<p>验证UFW的安装和启用状态</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">ufw</span> <span class="n">status</span>
</pre></div>


</li>
<li>
<p>打开和编辑<code>/etc/default/ufw</code>文件 </p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="k">default</span><span class="o">/</span><span class="n">ufw</span>
</pre></div>


</li>
<li>
<p>设置 <code>DEFAULT_FORWARD_POLICY</code> 如下：</p>
<p>DEFAULT_FORWARD_POLICY="ACCEPT"</p>
</li>
<li>
<p>保存关闭文件。</p>
</li>
<li>
<p>重新加载UFW来使新规则生效。</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">ufw</span> <span class="n">reload</span>
</pre></div>


</li>
<li>
<p>允许 Docker 端口的入站规则</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">ufw</span> <span class="n">allow</span> <span class="mi">2375</span><span class="o">/</span><span class="n">tcp</span>
</pre></div>


</li>
</ol>
<h3>Docker 配置 DNS 服务</h3>
<p>无论是Ubuntu还是Ubuntu 桌面繁衍版在系统运行的时候都是使用<code>/etc/resolv.conf</code>配置文件中的127.0.0.1作为域名服务器(nameserver)。NetworkManager设置dnsmasq使用真实的dns服务器连接，并且设置 /etc/resolv.conf的域名服务为127.0.0.1。</p>
<p>在桌面环境下使用这些配置来运行 docker 容器的时候， Docker 用户会看到如下的警告：</p>
<div class="highlight"><pre><span class="n">WARNING</span><span class="o">:</span> <span class="n">Local</span> <span class="o">(</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">)</span> <span class="n">DNS</span> <span class="n">resolver</span> <span class="n">found</span> <span class="k">in</span> <span class="n">resolv</span><span class="o">.</span><span class="na">conf</span> <span class="n">and</span> <span class="n">containers</span>
<span class="n">can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">use</span> <span class="n">it</span><span class="o">.</span> <span class="n">Using</span> <span class="k">default</span> <span class="n">external</span> <span class="n">servers</span> <span class="o">:</span> <span class="o">[</span><span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">4.4</span><span class="o">]</span>
</pre></div>


<p>该警告是因为 Docker 容器不能使用本地的DNS服务。相反 Docker 使用一个默认的外部域名服务器。</p>
<p>为了避免此警告，你可以给 Docker 容器指定一个DNS服务器。或者你可以禁用 NetworkManager 的 <code>dnsmasq</code>。不过当禁止 <code>dnsmasq</code> 可能使某些网络的DNS解析速度变慢。</p>
<p>为 Docker 指定一个DNS服务器</p>
<ol>
<li>
<p>使用具有<code>sudo</code>权限的用户来登录你的Ubuntu。</p>
</li>
<li>
<p>打开并编辑 <code>/etc/default/docker</code></p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="k">default</span><span class="o">/</span><span class="n">docker</span>
</pre></div>


</li>
<li>
<p>添加设置 </p>
<div class="highlight"><pre><span class="n">DOCKER_OPTS</span><span class="o">=</span><span class="s">&quot;--dns 8.8.8.8&quot;</span>
</pre></div>


<p>使用8.8.8.8替换如192.168.1.1的本地DNS服务器。你可以指定多个DNS服务器，多个DNS服务器使用空格分割例如</p>
<div class="highlight"><pre><span class="o">--</span><span class="n">dns</span> <span class="mf">8.8.8.8</span> <span class="o">--</span><span class="n">dns</span> <span class="mf">192.168.1.1</span>
</pre></div>


<blockquote>
<p>警告:如果你正在使用的电脑需要连接到不同的网络,一定要选择一个公共DNS服务器。</p>
</blockquote>
</li>
<li>
<p>保存关闭文件。 </p>
</li>
<li>
<p>重启 Docker 进程 </p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">restart</span> <span class="n">docker</span>
</pre></div>


</li>
</ol>
<p>或者，作为替代先前的操作过程，禁止NetworkManager中的<code>dnsmasq</code>(这样会使你的网络变慢)</p>
<ol>
<li>
<p>打开和编辑 <code>/etc/default/docker</code></p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">NetworkManager</span><span class="o">/</span><span class="n">NetworkManager</span><span class="p">.</span><span class="n">conf</span>
</pre></div>


</li>
<li>
<p>注释掉 dns = dsnmasq：</p>
<div class="highlight"><pre><span class="n">dns</span><span class="o">=</span><span class="n">dnsmasq</span>
</pre></div>


</li>
<li>
<p>保存关闭文件</p>
</li>
<li>
<p>重启NetworkManager 和 Docker</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">restart</span> <span class="n">network</span><span class="o">-</span><span class="n">manager</span> <span class="err">$</span> <span class="n">sudo</span> <span class="n">restart</span> <span class="n">docker</span>
</pre></div>


</li>
</ol>
<h3>升级Docker</h3>
<p>在<code>wget</code>的时候使用<code>-N</code>参数来安装最新版本的Docker：</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">wget</span> <span class="o">-</span><span class="n">N</span> <span class="n">https</span><span class="o">:</span><span class="c1">//get.docker.com/ | sh</span>
</pre></div>


<p>转自：https://github.com/widuu/chinese_docker/edit/master/installation/ubuntu.md</p>
  </div>
</article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
          <li class="list-inline-item"><a href="https://qwertyI.github.io/authors.html">Authors</a></li>
          <li class="list-inline-item"><a href="https://qwertyI.github.io/archives.html">Archives</a></li>
          <li class="list-inline-item"><a href="https://qwertyI.github.io/categories.html">Categories</a></li>
          <li class="list-inline-item"><a href="https://qwertyI.github.io/tags.html">Tags</a></li>
        </ul>
        <p class="col-sm-6 text-sm-right text-muted">
          Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>