<!DOCTYPE html>
<html lang="zh">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>PyH.py深入理解 | Ning's Blog
</title>
  <link rel="canonical" href="https://qwertyI.github.io/html-pyh.html">



  <link rel="stylesheet" href="https://qwertyI.github.io/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://qwertyI.github.io/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://qwertyI.github.io/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://qwertyI.github.io/theme/css/style.css">


<meta name="description" content="python">
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1 class="title"><a href="https://qwertyI.github.io">Ning's Blog</a></h1>
          <ul class="list-inline">
            <li class="list-inline-item"><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
            <li class="list-inline-item"><a href="http://python.org/" target="_blank">Python.org</a></li>
            <li class="list-inline-item"><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
            <li class="list-inline-item"><a href="https://www.cnblogs.com/" target="_blank">cnblog</a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>PyH.py深入理解
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2017-02-15T10:20:00">
        <i class="fa fa-clock-o"></i>
        三 15 二月 2017
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://qwertyI.github.io/category/python.html">Python</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://qwertyI.github.io/">N</a>,         <a href="https://qwertyI.github.io/">i</a>,         <a href="https://qwertyI.github.io/">n</a>,         <a href="https://qwertyI.github.io/">g</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://qwertyI.github.io/tag/python.html">#python</a>,         <a href="https://qwertyI.github.io/tag/test.html">#test</a>      </li>
    </ul>
  </header>
  <div class="content">
    <h2>PyH.py 深入理解</h2>
<p>PyH is a simple python module (pyh.py) that lets you generate html output in a convenient and intuitive manner.</p>
<p>官方的解释很简单，用一种很方便很直观的方式去生成html界面。</p>
<h3>1.先来用它</h3>
<p><strong>1.</strong>
一个最简单的PyH程序，生成一个空白界面，只含有一个title。</p>
<div class="highlight"><pre><span class="n">page</span> <span class="o">=</span> <span class="n">PyH</span><span class="p">(</span><span class="err">&#39;</span><span class="n">test</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">print</span> <span class="n">page</span><span class="p">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>


<p><strong>2.</strong>
新建一个表格，把表格填满数据。</p>
<div class="highlight"><pre><span class="n">ddata</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">PyH</span><span class="p">(</span><span class="err">&#39;</span><span class="n">test</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">data_tab</span> <span class="o">=</span> <span class="n">page</span> <span class="o">&lt;&lt;</span> <span class="n">table</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">:</span>
    <span class="n">tr1</span> <span class="o">=</span> <span class="n">tr</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="err">&#39;#</span><span class="n">FFFFFF</span><span class="err">&#39;</span><span class="p">)</span>
    <span class="n">row_tr</span> <span class="o">=</span> <span class="n">data_tab</span> <span class="o">&lt;&lt;</span> <span class="n">tr1</span>
    <span class="k">for</span> <span class="n">j</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">:</span>
        <span class="n">row_tr</span> <span class="o">&lt;&lt;</span> <span class="n">td</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="err">，</span> <span class="n">bgcolor</span><span class="o">=</span><span class="err">&#39;#</span><span class="n">ABABAB</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">print</span> <span class="n">page</span><span class="p">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>


<p>pyh.py的使用非常方便也非常直观正如它的说明一样，新的标签只需要用类似<code>&lt;&lt; table()</code>的代码就可以加入到我们的page，我们也可以通过<code>tr1 = tr(bgcolor='#FFFFFF')</code>去实例化一个Tag，在里面添加我们需要的属性然后在加入我们的page中。所有的Tag都可以使用<code>&lt;&lt;</code>去设定自己的子节点标签。</p>
<h3>2.来看源码</h3>
<p><strong>1.Tag的<code>__init__</code>作用</strong></p>
<div class="highlight"><pre><span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span><span class="o">:</span>
    <span class="n">print</span> <span class="n">arg</span>
    <span class="n">print</span> <span class="n">kw</span>
    <span class="n">self</span><span class="p">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">kw</span>
    <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">tagname</span> <span class="o">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">tagname</span>
        <span class="n">self</span><span class="p">.</span><span class="n">isSeq</span> <span class="o">=</span> <span class="n">False</span>
    <span class="nl">else:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">sequence</span><span class="err">&#39;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">isSeq</span> <span class="o">=</span> <span class="n">True</span>
    <span class="n">self</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">kw</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="err">&#39;</span><span class="n">id</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="err">#</span><span class="n">self</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="n">in</span> <span class="n">arg</span><span class="o">:</span> <span class="n">self</span><span class="p">.</span><span class="n">addObj</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>


<p>我在源码中加入了两个print，可以看到arg中记录了所有的Content，用于显示的；kw中记录了所有的标签的attributes。这些都可以用于其他函数的使用。</p>
<p><strong>2.&lt;&lt;是什么</strong>
初次使用pyh，第一眼最让人好奇的应该就是这个操作符了。为什么用它就能把标签放进去呢？ctrl+左键进入源码</p>
<div class="highlight"><pre><span class="n">def</span> <span class="n">__lshift__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span> <span class="o">+=</span> <span class="n">obj</span>
        <span class="n">print</span> <span class="n">self</span>
        <span class="k">if</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span><span class="o">:</span>
            <span class="k">return</span> <span class="n">obj</span>
</pre></div>


<p>上面的代码我稍微加了两个print，以便我们更清晰的看到它的结构。</p>
<div class="highlight"><pre><span class="n">page</span> <span class="o">=</span> <span class="n">PyH</span><span class="p">(</span><span class="err">&#39;</span><span class="n">aaa</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">page</span> <span class="o">&lt;&lt;</span> <span class="n">h1</span><span class="p">(</span><span class="err">&#39;</span><span class="n">aaa</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">page</span> <span class="o">&lt;&lt;</span> <span class="n">table</span><span class="p">(</span><span class="err">&#39;</span><span class="n">bbb</span><span class="err">&#39;</span> <span class="n">bgcolor</span><span class="o">=</span><span class="err">&#39;#</span><span class="n">ABABAB</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">atr</span> <span class="o">=</span> <span class="n">tab</span> <span class="o">&lt;&lt;</span> <span class="n">tr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">bbb</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">atr</span> <span class="o">&lt;&lt;</span> <span class="n">td</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ccc</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">page</span> <span class="o">&lt;&lt;</span> <span class="n">div</span><span class="p">()</span>
</pre></div>


<p>我们可以看到，这样的话我们把层级结构就放入了一个list中，这样每个层级都会记录它的tagname还有相应的标签内容。</p>
<p><strong>3.render()做什么用</strong></p>
<div class="highlight"><pre><span class="nx">def</span> <span class="nb">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self.</span><span class="nb">tagname</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&lt;%s%s%s&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self.</span><span class="nb">tagname</span><span class="p">,</span> <span class="bp">self.</span><span class="nx">renderAtt</span><span class="p">(),</span> <span class="bp">self.</span><span class="nx">selfClose</span><span class="p">()</span><span class="o">*</span><span class="s1">&#39; /&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self.</span><span class="nx">selfClose</span><span class="p">():</span>
            <span class="nb">for</span> <span class="n">c</span> <span class="k">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="nx">isinstance</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="kt">Tag</span><span class="p">):</span>
                    <span class="nb">result</span> <span class="o">+=</span> <span class="nx">c.render</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">result</span> <span class="o">+=</span> <span class="nx">c</span>
            <span class="k">if</span> <span class="bp">self.</span><span class="nb">tagname</span><span class="p">:</span>
                <span class="nb">result</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/%s&gt;&#39;</span> <span class="o">%</span> <span class="bp">self.</span><span class="nb">tagname</span>
        <span class="nb">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="nb">result</span>
</pre></div>


<p>render函数实现了将<code>__lsshift__</code>中存入的self信息全部取出之后，形成HTML文件。而这里使用到的<code>self.renderAtt()</code>目的是将attributes形式格式以放入我们的文件中；<code>self.selfClose()</code>判断特定的标签从而有特殊的写入形式。</p>
<p><strong>4.Pyh的工厂</strong>
上面简单介绍了一下Tag类的一些作用，一个Tag类自然不能覆盖所有的标签，所以PyH提供了一个工厂类</p>
<div class="highlight"><pre><span class="n">def</span> <span class="n">TagFactory</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">:</span>
    <span class="n">class</span> <span class="n">f</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span><span class="o">:</span>
        <span class="n">tagname</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">f</span><span class="p">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">f</span>

<span class="n">thisModule</span> <span class="o">=</span> <span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">]</span>

<span class="k">for</span> <span class="n">t</span> <span class="n">in</span> <span class="n">tags</span><span class="o">:</span> <span class="n">setattr</span><span class="p">(</span><span class="n">thisModule</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">TagFactory</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</pre></div>


<p>很明显，这是整个程序可以完成生成网页这个任务的最重要一步，工厂中有一个类f，继承自Tag类，整个工厂最后会返回这个f，然后每个Tags中的标签都会是f的实例。从而我们可以使用<code>page &lt;&lt; h1('aaa')</code>去加入我们想要的标签。</p>
<h3>3.总结</h3>
<p>pyh的源码看到这里，代码很少，而且相对来说也比较容易理解，不过对我来说&lt;&lt;这个点以前完全没有注意到，我也是基于想要了解&lt;&lt;是怎么工作的才翻看了整个代码，从而又额外学习到了工厂的知识，获益良多。里面肯定还有疏漏的地方，也有理解不深或懒得继续探究而没有看出来的精彩代码，只能留待以后了（笑）。</p>
  </div>
</article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
          <li class="list-inline-item"><a href="https://qwertyI.github.io/authors.html">Authors</a></li>
          <li class="list-inline-item"><a href="https://qwertyI.github.io/archives.html">Archives</a></li>
          <li class="list-inline-item"><a href="https://qwertyI.github.io/categories.html">Categories</a></li>
          <li class="list-inline-item"><a href="https://qwertyI.github.io/tags.html">Tags</a></li>
        </ul>
        <p class="col-sm-6 text-sm-right text-muted">
          Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>