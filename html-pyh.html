<!DOCTYPE html>
<html lang="zh">

<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="/html-pyh.html" />

    <title>  Ning's Blog &mdash; PyH.py深入理解
</title>




    <link rel="stylesheet" href="/theme/css/style.css">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <meta name="author" content="Ning">
    <meta name="description" content="python">
  <meta name="tags" contents="python, test, ">
</head>

<body>
<header class="header">
  <div class="container">
    <div class="header-inner">
      <h1 class="header-name">
        <a class="nodec" href="">Ning's Blog</a>
      </h1>
      <h3 class="header-text"></h3>
      <ul class="header-menu list-inline">
          <li><a class="nodec icon-mail-alt" href="mailto:727665171@qq.com"></a></li>
          <li><a class="nodec icon-github" href="https://github.com/y503869692"></a></li>
      </ul>
    </div>
  </div>
</header> <!-- /.header -->  <div class="container">
  <div class="post full-post">
    <h1 class="post-title">
      <a href="/html-pyh.html" title="Permalink to PyH.py深入理解">PyH.py深入理解</a>
    </h1>
    <ul class="list-inline">
      <li class="post-date">
        <a class="text-muted" href="/html-pyh.html" title="2017-02-15T10:20:00">三 15 二月 2017</a>
      </li>
      <li class="muted">&middot;</li>
      <li class="post-category">
        <a href="/category/python.html">Python</a>
      </li>
        <li class="muted">&middot;</li>
        <li>
            <a href="/tag/python.html">python</a>,             <a href="/tag/test.html">test</a>        </li>
    </ul>
    <div class="post-content">
      <h2>PyH.py 深入理解</h2>
<p>PyH is a simple python module (pyh.py) that lets you generate html output in a convenient and intuitive manner.</p>
<p>官方的解释很简单，用一种很方便很直观的方式去生成html界面。</p>
<h5>1.先来用它</h5>
<p><strong>1.</strong>
一个最简单的PyH程序，生成一个空白界面，只含有一个title。</p>
<div class="highlight"><pre><span></span>page = PyH(&#39;test&#39;)
print page.render()
</pre></div>


<p><strong>2.</strong>
新建一个表格，把表格填满数据。</p>
<div class="highlight"><pre><span></span>ddata = [[1, 2], [2, 3]]
page = PyH(&#39;test&#39;)
data_tab = page &lt;&lt; table()
for i in range(len(data)):
    tr1 = tr(bgcolor=&#39;#FFFFFF&#39;)
    row_tr = data_tab &lt;&lt; tr1
    for j in range(len(data[i])):
        row_tr &lt;&lt; td(data[i][j]， bgcolor=&#39;#ABABAB&#39;)
print page.render()
</pre></div>


<p>pyh.py的使用非常方便也非常直观正如它的说明一样，新的标签只需要用类似<code>&lt;&lt; table()</code>的代码就可以加入到我们的page，我们也可以通过<code>tr1 = tr(bgcolor='#FFFFFF')</code>去实例化一个Tag，在里面添加我们需要的属性然后在加入我们的page中。所有的Tag都可以使用<code>&lt;&lt;</code>去设定自己的子节点标签。</p>
<h5>2.来看源码</h5>
<p><strong>1.Tag的<code>__init__</code>作用</strong></p>
<div class="highlight"><pre><span></span>def __init__(self, *arg, **kw):
    print arg
    print kw
    self.attributes = kw
    if self.tagname :
        name = self.tagname
        self.isSeq = False
    else:
        name = &#39;sequence&#39;
        self.isSeq = True
    self.id = kw.get(&#39;id&#39;, name)
    #self.extend(arg)
    for a in arg: self.addObj(a)
</pre></div>


<p>我在源码中加入了两个print，可以看到arg中记录了所有的Content，用于显示的；kw中记录了所有的标签的attributes。这些都可以用于其他函数的使用。</p>
<p><strong>2.&lt;&lt;是什么</strong>
初次使用pyh，第一眼最让人好奇的应该就是这个操作符了。为什么用它就能把标签放进去呢？ctrl+左键进入源码</p>
<div class="highlight"><pre><span></span>def __lshift__(self, obj):
        self += obj
        print self
        if isinstance(obj, Tag):
            return obj
</pre></div>


<p>上面的代码我稍微加了两个print，以便我们更清晰的看到它的结构。</p>
<div class="highlight"><pre><span></span>page = PyH(&#39;aaa&#39;)
page &lt;&lt; h1(&#39;aaa&#39;)
tab = page &lt;&lt; table(&#39;bbb&#39; bgcolor=&#39;#ABABAB&#39;)
atr = tab &lt;&lt; tr(&#39;bbb&#39;)
atr &lt;&lt; td(&#39;ccc&#39;)
page &lt;&lt; div()
</pre></div>


<p>我们可以看到，这样的话我们把层级结构就放入了一个list中，这样每个层级都会记录它的tagname还有相应的标签内容。</p>
<p><strong>3.render()做什么用</strong></p>
<div class="highlight"><pre><span></span>def render(self):
        result = &#39;&#39;
        if self.tagname:
            result = &#39;<span class="err">&lt;</span>%s%s%s&gt;&#39; % (self.tagname, self.renderAtt(), self.selfClose()*&#39; /&#39;)
        if not self.selfClose():
            for c in self:
                if isinstance(c, Tag):
                    result += c.render()
                else:
                    result += c
            if self.tagname:
                result += &#39;<span class="err">&lt;</span>/%s&gt;&#39; % self.tagname
        result += &#39;\n&#39;
        return result
</pre></div>


<p>render函数实现了将<code>__lsshift__</code>中存入的self信息全部取出之后，形成HTML文件。而这里使用到的<code>self.renderAtt()</code>目的是将attributes形式格式以放入我们的文件中；<code>self.selfClose()</code>判断特定的标签从而有特殊的写入形式。</p>
<p><strong>4.Pyh的工厂</strong>
上面简单介绍了一下Tag类的一些作用，一个Tag类自然不能覆盖所有的标签，所以PyH提供了一个工厂类</p>
<div class="highlight"><pre><span></span>def TagFactory(name):
    class f(Tag):
        tagname = name
    f.__name__ = name
    return f

thisModule = modules[__name__]

for t in tags: setattr(thisModule, t, TagFactory(t))
</pre></div>


<p>很明显，这是整个程序可以完成生成网页这个任务的最重要一步，工厂中有一个类f，继承自Tag类，整个工厂最后会返回这个f，然后每个Tags中的标签都会是f的实例。从而我们可以使用<code>page &lt;&lt; h1('aaa')</code>去加入我们想要的标签。</p>
<h5>3.总结</h5>
<p>pyh的源码看到这里，代码很少，而且相对来说也比较容易理解，不过对我来说&lt;&lt;这个点以前完全没有注意到，我也是基于想要了解&lt;&lt;是怎么工作的才翻看了整个代码，从而又额外学习到了工厂的知识，获益良多。里面肯定还有疏漏的地方，也有理解不深或懒得继续探究而没有看出来的精彩代码，只能留待以后了（笑）。</p>
    </div>
  </div>
  <hr class="separator">
  <div class="col-md-8 col-md-offset-2">
  </div>
  </div>
<footer class="footer">
  <div class="container">
    <p class="text-center">
      Ning, <a href="" target="_blank"></a> unless otherwise noted.
    </p>
    <div class="text-center">
      Generated by <a href="http://getpelican.com" target="_blank">Pelican</a> with the <a href="http://github.com/nairobilug/pelican-alchemy">alchemy</a> theme.
    </div>
  </div>
</footer> <!-- /.footer -->
  <script src="/theme/js/jquery.min.js"></script>
  <script src="/theme/js/bootstrap.min.js"></script>
</body> <!-- 42 -->

</html>